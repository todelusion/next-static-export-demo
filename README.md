### Next.js éœæ…‹è¼¸å‡ºæŠ€å·§èˆ‡æ³¨æ„äº‹é … ğŸš€

éœæ…‹ç¶²ç«™ç”Ÿæˆï¼ˆStatic Exportï¼‰æ˜¯ Next.js æä¾›çš„ä¸€é …åŠŸèƒ½ï¼Œå…è¨±å°‡ç¶²é æ‡‰ç”¨æ‰“åŒ…æˆéœæ…‹æª”æ¡ˆï¼Œé©åˆéƒ¨ç½²åœ¨ä»»ä½•éœæ…‹ä¼ºæœå™¨ä¸Šã€‚

ğŸ‘‰ **GitHub å°ˆæ¡ˆç¯„ä¾‹**ï¼š  
æ‚¨å¯ä»¥ç›´æ¥æŸ¥çœ‹é€™ä»½é–‹ç®±å³ç”¨çš„ç¯„ä¾‹å°ˆæ¡ˆï¼š  
[GitHub - next-static-export-demo](https://github.com/todelusion/next-static-export-demo)

ä»¥ä¸‹æ˜¯éœæ…‹è¼¸å‡ºä¸­éœ€è¦æ³¨æ„çš„å¹¾å€‹é—œéµé»ï¼š

---

### 1ï¸âƒ£ è¨­å®šéœæ…‹å°å‡º `output: "export"`

åœ¨ `next.config.js` ä¸­åŠ å…¥ä»¥ä¸‹è¨­å®šï¼Œå‘Šè¨´ Next.js ä½¿ç”¨éœæ…‹å°å‡ºæ¨¡å¼ï¼š

```javascript
// next.config.js
module.exports = {
  output: "export",
};
```

- **åŸ·è¡Œéœæ…‹å°å‡º**ï¼šåªéœ€åŸ·è¡Œ `next build`ï¼Œç„¡éœ€é¡å¤–åŸ·è¡Œ `next export`ã€‚

---

### 2ï¸âƒ£ `assetPrefix` çš„ä½¿ç”¨æƒ…å¢ƒ ğŸŒ

åœ¨éœæ…‹ç¶²ç«™ä¸­ï¼Œè³‡æºè·¯å¾‘å¯èƒ½éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œç‰¹åˆ¥æ˜¯åœ¨ç¶²ç«™éƒ¨ç½²æ–¼å­ç›®éŒ„ä¸‹æ™‚ã€‚

#### è§£æ³•ï¼šä½¿ç”¨ç’°å¢ƒè®Šæ•¸åˆ‡æ›è³‡æºè·¯å¾‘
- **é–‹ç™¼æ¨¡å¼**ï¼šè¨­å®š `assetPrefix: ""`ï¼Œé¿å…ç†±åˆ·æ–°å¤±æ•ˆã€‚
- **ç”Ÿç”¢æ¨¡å¼**ï¼šè¨­å®š `assetPrefix: "./"`ï¼Œä»¥é©æ‡‰ç›¸å°è·¯å¾‘éœ€æ±‚ï¼Œç¢ºä¿éœæ…‹è³‡æºæ­£ç¢ºè¼‰å…¥ã€‚

```javascript
// next.config.js
module.exports = {
  assetPrefix: process.env.ENV_VAR === "production" ? "./" : "",
};
```

---

### 3ï¸âƒ£ `/fonts/...` è·¯å¾‘å¤±æ•ˆçš„æƒ…æ³èˆ‡è§£æ³•

åœ¨éœæ…‹è¼¸å‡ºæ¨¡å¼ä¸‹ï¼Œ`public` ç›®éŒ„ä¸­çš„æ–‡ä»¶è‹¥ä»¥çµ•å°è·¯å¾‘ï¼ˆå¦‚ `/fonts/...`ï¼‰å¼•ç”¨ï¼Œéƒ¨ç½²åˆ°å­ç›®éŒ„æ™‚æœƒç„¡æ³•æ­£ç¢ºè¼‰å…¥ã€‚

#### å•é¡Œæè¿°
ç¶²ç«™éƒ¨ç½²åœ¨å­ç›®éŒ„ï¼ˆå¦‚ `https://example.com/subpath/`ï¼‰æ™‚ï¼š
- **éŒ¯èª¤è·¯å¾‘**ï¼š`/fonts/...` è¢«è§£æç‚º `https://example.com/fonts/...`ã€‚
- **æ­£ç¢ºè·¯å¾‘**ï¼šæ‡‰ç‚º `https://example.com/subpath/fonts/...`ã€‚

#### è§£æ³•ï¼šæ”¹ç”¨ç›¸å°è·¯å¾‘
å°‡ `/fonts/...` æ”¹ç‚ºç›¸å°è·¯å¾‘ï¼Œä¾‹å¦‚ `../../../fonts/...`ï¼Œç¢ºä¿è³‡æºåŸºæ–¼å¯¦éš›æ–‡ä»¶ä½ç½®æ­£ç¢ºè¼‰å…¥ã€‚

```css
/* éŒ¯èª¤çš„å¼•ç”¨è·¯å¾‘ï¼ˆéœæ…‹è¼¸å‡ºé»˜èªï¼‰ */
url('/fonts/FakePearl-Regular.ttf');
/* è¢«è§£é‡‹ç‚ºï¼š`https://example.com/fonts/FakePearl-Regular.ttf`ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰ã€‚ */

/* æ­£ç¢ºçš„å¼•ç”¨è·¯å¾‘ï¼ˆéœ€è¦æ‰‹å‹•ä¿®æ”¹ï¼‰ */
url('../../../fonts/FakePearl-Regular.ttf');
/* è¢«è§£é‡‹ç‚ºï¼š`https://example.com/subpath/fonts/FakePearl-Regular.ttf`ã€‚ */
```

---

### 4ï¸âƒ£ è‡ªå‹•ä¿®æ”¹å­—å‹è·¯å¾‘ âœ¨

ä½¿ç”¨å·¥å…· `replace-in-file`ï¼Œå°‡è¼¸å‡ºçš„ CSS æ–‡ä»¶ä¸­å¼•ç”¨çš„å­—å‹è·¯å¾‘è‡ªå‹•ä¿®æ”¹ç‚ºç›¸å°è·¯å¾‘ã€‚

#### è¨­å®šæ­¥é©Ÿ
1. **æ–°å¢ `config.js`**ï¼šé…ç½®æ›¿æ›é‚è¼¯ã€‚
2. **ä¿®æ”¹ `package.json`**ï¼šåœ¨ build æŒ‡ä»¤ä¸­åŸ·è¡Œæ›¿æ›æ“ä½œã€‚

#### ç¯„ä¾‹ä»£ç¢¼

```javascript
// config.js
const replace = require("replace-in-file");

module.exports = {
  files: "./out/_next/static/css/*.css",
  from: ["/fonts/FakePearl-Regular.ttf"],
  to: ["../../../fonts/FakePearl-Regular.ttf"],
};
```

```json
// package.json
"scripts": {
  "build": "cross-env ENV_VAR=production next build && replace-in-file --configFile=config.js"
}
```

---

### 5ï¸âƒ£ éœæ…‹è¼¸å‡ºå¾Œçš„æ–‡ä»¶çµæ§‹è£œå…… ğŸ—‚ï¸

éœæ…‹è¼¸å‡ºå¾Œçš„æ–‡ä»¶çµæ§‹å¦‚ä¸‹ï¼š

```
out/
â”œâ”€â”€ _next/
â”‚   â”œâ”€â”€ static/
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â””â”€â”€ styles.css  # å­—å‹è·¯å¾‘å·²æ›´æ–°
â”‚   â””â”€â”€ ...
â”œâ”€â”€ fonts/
â”‚   â”œâ”€â”€ FakePearl-Regular.ttf
â”‚   â””â”€â”€ ...
```

åœ¨ `styles.css` ä¸­ï¼Œå­—å‹è·¯å¾‘æ›´æ–°ç‚ºç›¸å°è·¯å¾‘ï¼š

```css
url('../../../fonts/FakePearl-Regular.ttf');
```

---

### çµè«–

1. **éœæ…‹å°å‡º**ï¼šåŸ·è¡Œ `next build` å³å¯å®Œæˆéœæ…‹è¼¸å‡ºã€‚
2. **è³‡æºè·¯å¾‘è™•ç†**ï¼šä½¿ç”¨ `assetPrefix` é…åˆç’°å¢ƒè®Šæ•¸è¨­å®šï¼Œè§£æ±ºé–‹ç™¼èˆ‡ç”Ÿç”¢çš„è³‡æºè·¯å¾‘å•é¡Œã€‚
3. **å­—å‹è·¯å¾‘è‡ªå‹•åŒ–**ï¼šåˆ©ç”¨ `replace-in-file` å·¥å…·ï¼Œå°‡ CSS æ–‡ä»¶ä¸­çš„å­—å‹è·¯å¾‘æ›¿æ›ç‚ºç›¸å°è·¯å¾‘ã€‚
4. **éƒ¨ç½²æ–¼å­ç›®éŒ„**ï¼šæ­£ç¢ºè¨­å®šç›¸å°è·¯å¾‘ï¼Œç¢ºä¿è³‡æºè¼‰å…¥ç„¡èª¤ã€‚

é€éä»¥ä¸ŠæŠ€å·§ï¼Œç„¡è«–éƒ¨ç½²æ–¼ä½•è™•ï¼Œéœæ…‹ç«™é»éƒ½èƒ½æ­£ç¢ºè¼‰å…¥æ‰€æœ‰è³‡æºï¼âœ…

